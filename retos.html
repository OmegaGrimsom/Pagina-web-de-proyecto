<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Retos - Aprende Programaci√≥n</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="estilos.css">
  <style>
    .ayuda {
      color: #d35400;
      margin-top: 5px;
    }
    textarea {
      width: 100%;
      height: 200px;
      border-radius: 8px;
      border: 1px solid #ccc;
      padding: 10px;
      font-family: monospace;
      font-size: 14px;
    }
    iframe {
      width: 100%;
      height: 150px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-top: 10px;
      background: #fff;
    }
    button {
      margin: 5px 5px 5px 0;
      padding: 8px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      background: #4a6cf7;
      color: #fff;
    }
    button:hover {
      background: #3546a7;
    }
  </style>
</head>
<body>

<header class="encabezado">
  <h1>üèÜ Retos</h1>
  <nav class="navegacion">
    <a href="index.html">Inicio</a>
    <a href="teoria.html">Teor√≠a</a>
    <a href="lenguajes.html">Lenguajes</a>
    <a href="ejercicios.html">Ejercicios</a>
    <a href="retos.html">Retos</a>
    <a href="progreso.html">Progreso</a>
    <a href="tutoriales.html">Tutoriales</a>
    <a href="trivia.html">Trivia</a>
  </nav>
</header>

<main class="contenido-principal">

  <section class="tarjeta">
    <h2>üîç Reto 1: Inversi√≥n de texto</h2>
    <p>Escribe un programa que invierta el texto ingresado por el usuario.</p>
    <textarea id="reto1">// Escribe aqu√≠ tu c√≥digo JS
let texto = "Hola";
console.log(texto.split("").reverse().join("")); </textarea>
    <br>
    <button onclick="ejecutarCodigo('reto1','salida1')">‚ñ∂ Ejecutar c√≥digo</button>
    <button onclick="marcarReto(1)">Marcar como completado</button>
    <button onclick="mostrarAyuda(1)">üõà Ayuda</button>
    <p id="ayuda1" class="ayuda" style="display:none;">
      Piensa en c√≥mo puedes recorrer la cadena desde el final hacia el inicio.
    </p>
    <iframe id="salida1"></iframe>
  </section>

  <section class="tarjeta">
    <h2>üßÆ Reto 2: Suma de los primeros 100 n√∫meros</h2>
    <p>Escribe un programa que calcule la suma de los n√∫meros del 1 al 100.</p>
    <textarea id="reto2">// Tu c√≥digo aqu√≠
let suma = 0;
for(let i=1;i<=100;i++){ suma+=i; }
console.log("La suma es: "+suma);</textarea>
    <br>
    <button onclick="ejecutarCodigo('reto2','salida2')">‚ñ∂ Ejecutar c√≥digo</button>
    <button onclick="marcarReto(2)">Marcar como completado</button>
    <button onclick="mostrarAyuda(2)">üõà Ayuda</button>
    <p id="ayuda2" class="ayuda" style="display:none;">
      Usa un bucle para ir sumando los n√∫meros desde 1 hasta 100.
    </p>
    <iframe id="salida2"></iframe>
  </section>

  <section class="tarjeta">
    <h2>üî¢ Reto 3: N√∫meros primos</h2>
    <p>Escribe una funci√≥n que diga si un n√∫mero es primo o no.</p>
    <textarea id="reto3">// Tu c√≥digo aqu√≠
function esPrimo(n){
  if(n<=1) return false;
  for(let i=2;i<n;i++){
    if(n%i===0) return false;
  }
  return true;
}
console.log(esPrimo(7));</textarea>
    <br>
    <button onclick="ejecutarCodigo('reto3','salida3')">‚ñ∂ Ejecutar c√≥digo</button>
    <button onclick="marcarReto(3)">Marcar como completado</button>
    <button onclick="mostrarAyuda(3)">üõà Ayuda</button>
    <p id="ayuda3" class="ayuda" style="display:none;">
      Un n√∫mero es primo si solo es divisible por 1 y por s√≠ mismo.
    </p>
    <iframe id="salida3"></iframe>
  </section>

  <section class="tarjeta">
    <h2>üì¶ Reto 4: Arreglo al rev√©s</h2>
    <p>Crea un arreglo y luego genera uno nuevo con los elementos en orden inverso.</p>
    <textarea id="reto4">// Tu c√≥digo aqu√≠
let arr = [1,2,3,4,5];
console.log(arr.reverse());</textarea>
    <br>
    <button onclick="ejecutarCodigo('reto4','salida4')">‚ñ∂ Ejecutar c√≥digo</button>
    <button onclick="marcarReto(4)">Marcar como completado</button>
    <button onclick="mostrarAyuda(4)">üõà Ayuda</button>
    <p id="ayuda4" class="ayuda" style="display:none;">
      Piensa en usar un bucle que recorra el arreglo desde el √∫ltimo elemento hasta el primero.
    </p>
    <iframe id="salida4"></iframe>
  </section>

  <section class="tarjeta">
    <h2>üìÜ Reto 5: Edad exacta</h2>
    <p>Pide al usuario su a√±o de nacimiento y muestra cu√°ntos a√±os tiene.</p>
    <textarea id="reto5">// Tu c√≥digo aqu√≠
let nacimiento = 2000;
let actual = new Date().getFullYear();
console.log("Tienes " + (actual-nacimiento) + " a√±os");</textarea>
    <br>
    <button onclick="ejecutarCodigo('reto5','salida5')">‚ñ∂ Ejecutar c√≥digo</button>
    <button onclick="marcarReto(5)">Marcar como completado</button>
    <button onclick="mostrarAyuda(5)">üõà Ayuda</button>
    <p id="ayuda5" class="ayuda" style="display:none;">
      Obt√©n el a√±o actual con <code>new Date().getFullYear()</code> y r√©stale el a√±o de nacimiento.
    </p>
    <iframe id="salida5"></iframe>
  </section>

</main>

<footer class="pie">
  <p>&copy; 2025 Aprende Programaci√≥n - Hecho con ‚ù§Ô∏è para estudiantes de secundaria.</p>
</footer>

<script>
  const usuario = localStorage.getItem("usuarioActual");

  function ejecutarCodigo(textareaId, salidaId){
    const code = document.getElementById(textareaId).value;
    const iframe = document.getElementById(salidaId);
    const doc = iframe.contentDocument || iframe.contentWindow.document;

    // Preparamos el iframe con un entorno que capture console.log
    doc.open();
    doc.write(`
      <body>
        <div id="output"></div>
        <script>
          const output = document.getElementById('output');
          console.log = msg => {
            const p = document.createElement('p');
            p.textContent = msg;
            output.appendChild(p);
          };
        <\/script>
      </body>
    `);
    doc.write('<script>' + code + '<\/script>');
    doc.close();
  }

  function marcarReto(numero){
    const clave = usuario ? `${usuario}_reto${numero}` : `reto${numero}`;
    localStorage.setItem(clave,"true");
    alert(`‚úÖ ¬°Reto ${numero} marcado como completado!`);
    actualizarRango();
  }

  function mostrarAyuda(numReto){
    const ayuda = document.getElementById(`ayuda${numReto}`);
    ayuda.style.display = ayuda.style.display === "none" ? "block" : "none";
  }

  function obtenerProgreso(clave,total){
    let completados = 0;
    for(let i=1;i<=total;i++){
      const claveGuardada = usuario ? `${usuario}_${clave}${i}` : `${clave}${i}`;
      if(localStorage.getItem(claveGuardada)==="true") completados++;
    }
    return completados;
  }

  function actualizarRango(){
    const ejerciciosTotales = 7;
    const retosTotales = 5;
    const triviaTotales = 10;

    const ejerciciosCompletados = obtenerProgreso("ejercicio",ejerciciosTotales);
    const retosCompletados = obtenerProgreso("reto",retosTotales);
    const triviaCompletada = obtenerProgreso("trivia",triviaTotales);

    const total = ejerciciosCompletados + retosCompletados + triviaCompletada;

    let rango = "Principiante";
    if(total>=5) rango="Aprendiz";
    if(total>=10) rango="Intermedio";
    if(total>=15) rango="Avanzado";
    if(total>=20) rango="¬°Maestro! üéâ";

    console.log(`Tu rango actual: ${rango}`);
  }

  actualizarRango();
</script>

</body>
</html>
